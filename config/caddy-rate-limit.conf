{
    order rate_limit before reverse_proxy
}

http://localhost:8081 {
    encode gzip

    # Bot detection (block curl)
    @bots {
        header User-Agent *curl*
    }
    respond @bots 403 {
        body "Bot Detected"
    }

    # Rate limiting for /api/unprotected (20 req/s per IP)
    @unprotected {
        path /api/unprotected
    }
    rate_limit @unprotected {
        zone unprotected_limit
        rate 20r/s
    }

    # Reverse proxy
    reverse_proxy http://localhost:3000

    # Disable caching
    header {
        Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0"
        Pragma "no-cache"
        Expires "0"
    }
}